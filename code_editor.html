<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link href="./styles.css" rel="stylesheet">

    <script type="text/javascript" src="./ace.js"></script>
    <script type="text/javascript" src="./amode-javascript.js"></script>
    <script type="text/javascript" src="./theme-twilight.js"></script>

    <title>Custom Titlebar App</title>

    <style type="text/css" media="screen">
      #editor {
        position: absolute;
        top: 30px;
        right: 0;
        bottom: 0;
        left: 0;
      }

    </style>
  </head>

  <body>
    <div class="titlebar">ModiCode</div>

  <!-- Hidden Popup Menu -->
  <div class="color-popup" id="colorPopup">
    <label for="bgColorPicker">Background:</label>
    <input type="color" id="bgColorPicker" value="#141414">
  </div>

    <div class="editorContainer">
      <div id="editor">function foo(items) {
        var x = "All this is syntax highlighted";
        return x;
      }</div>
    </div>

    <script>
      var editor = ace.edit("editor");
      editor.setTheme("ace/theme/twilight");
      editor.session.setMode("ace/mode/javascript");
      editor.setShowPrintMargin(false);
      editor.setFontSize(12);

      function applyEditorBackground(color) {
        let style = document.getElementById("dynamic-ace-style");
        if (!style) {
          style = document.createElement("style");
          style.id = "dynamic-ace-style";
          document.head.appendChild(style);
        }

        style.textContent = `
          #editor.ace_editor {
            background-color: ${color} !important;
          }
        `;
      }

      const bgColorPicker = document.getElementById("bgColorPicker");
      bgColorPicker.addEventListener("input", (e) => {
        applyEditorBackground(e.target.value);
      });

      // Apply initial value
      applyEditorBackground(bgColorPicker.value);
    </script>

    <script>
      let ctrlPressed = false;

      document.addEventListener('keydown', (e) => {
        if (e.ctrlKey) ctrlPressed = true;
      });
      document.addEventListener('keyup', (e) => {
        if (!e.ctrlKey) ctrlPressed = false;
      });

      editor.container.addEventListener('wheel', (e) => {
        if (ctrlPressed) {
          e.preventDefault();
          const delta = e.deltaY < 0 ? 1 : -1;
          editor.setFontSize(editor.getFontSize() + delta);
        }
      }, { passive: false });
    </script>

    <script>
const popup = document.getElementById("colorPopup");

// Add command to Ace Editor to toggle popup on Ctrl+P
editor.commands.addCommand({
  name: "toggleColorPicker",
  bindKey: { win: "Ctrl-P", mac: "Command-P" },
  exec: function(editor) {
    if (popup.style.display === "block") {
      popup.style.display = "none";
    } else {
      popup.style.display = "block";
    }
  },
  readOnly: true, // so it works even if editor is read-only
});

    </script>
  </body>
</html>
